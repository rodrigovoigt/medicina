<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Busca Externa - Consulta Geral</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>üîç Teste Busca Externa - Consulta Geral</h2>
        
        <div class="alert alert-info">
            Este arquivo testa se a busca externa est√° funcionando da mesma forma que na p√°gina consulta-geral.html
        </div>

        <!-- Carregar navbar igual √† p√°gina original -->
        <div id="navbar-placeholder"></div>

        <div class="mt-4">
            <h4>üß™ Teste Manual:</h4>
            <div class="row">
                <div class="col-md-6">
                    <h6>Busca Externa (deve filtrar sites m√©dicos):</h6>
                    <form class="d-flex" action="https://duckduckgo.com/" method="get" target="_blank" onsubmit="addMedicalSiteFilter(event)">
                        <div class="input-group">
                            <input name="q" id="webSearch" class="form-control" type="search" placeholder="Ex: diabetes tratamento">
                            <button class="btn btn-primary" type="submit">ü©∫ Buscar</button>
                        </div>
                    </form>
                </div>
                
                <div class="col-md-6">
                    <h6>Status das Fun√ß√µes:</h6>
                    <div id="funcoes-status">Carregando...</div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <button onclick="testarFuncoes()" class="btn btn-success">üß™ Testar Fun√ß√µes</button>
            <button onclick="testarToast()" class="btn btn-info">üì¢ Testar Toast</button>
        </div>

        <div id="console-output" class="mt-4" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;"></div>
    </div>

    <!-- Scripts iguais √† p√°gina original -->
    <script src="../assets/js/navbar-loader.js" defer></script>
    <script src="../assets/js/navbar-utils.js"></script>
    <script>
        // Carregar navbar igual √† consulta-geral.html
        initializeNavbar("../navbar.html");
        
        // Interceptar console.log para mostrar na p√°gina
        const originalLog = console.log;
        const consoleOutput = document.getElementById('console-output');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : arg).join(' ');
            consoleOutput.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        // Testar fun√ß√µes ap√≥s carregamento
        setTimeout(() => {
            console.log('=== TESTE INICIAL ===');
            testarFuncoes();
        }, 3000);
        
        function testarFuncoes() {
            console.log('=== TESTE DE FUN√á√ïES GLOBAIS ===');
            
            const funcoes = {
                'addMedicalSiteFilter': typeof window.addMedicalSiteFilter,
                'showToast': typeof window.showToast,
                'showToastMessage': typeof window.showToastMessage,
                'setupGlobalSearchFunctions': typeof window.setupGlobalSearchFunctions,
                'ensureSearchFunctionality': typeof window.ensureSearchFunctionality,
                'trustedMedicalSites': typeof window.trustedMedicalSites !== 'undefined' ? `array[${window.trustedMedicalSites?.length}]` : 'undefined'
            };
            
            let statusHtml = '<ul>';
            Object.entries(funcoes).forEach(([nome, tipo]) => {
                const icon = tipo === 'function' || tipo.includes('array') ? '‚úÖ' : '‚ùå';
                statusHtml += `<li>${icon} <strong>${nome}:</strong> ${tipo}</li>`;
                console.log(`${icon} ${nome}: ${tipo}`);
            });
            statusHtml += '</ul>';
            
            document.getElementById('funcoes-status').innerHTML = statusHtml;
            
            // Testar formul√°rio de busca
            const form = document.querySelector('form[onsubmit*="addMedicalSiteFilter"]');
            if (form) {
                console.log('‚úÖ Formul√°rio de busca encontrado');
            } else {
                console.log('‚ùå Formul√°rio de busca N√ÉO encontrado');
            }
        }
        
        function testarToast() {
            if (typeof window.showToast === 'function') {
                window.showToast('üéâ Toast funcionando!');
                console.log('‚úÖ Toast executado');
            } else {
                alert('‚ùå showToast n√£o est√° dispon√≠vel');
                console.log('‚ùå showToast n√£o dispon√≠vel');
            }
        }
        
        // Teste autom√°tico da busca externa
        function testarBuscaExterna() {
            const input = document.getElementById('webSearch');
            if (input && typeof window.addMedicalSiteFilter === 'function') {
                input.value = 'diabetes tratamento';
                console.log('üß™ Testando busca externa com: "diabetes tratamento"');
                
                // Simular evento
                const form = input.closest('form');
                const event = { target: form, preventDefault: () => console.log('preventDefault chamado') };
                
                try {
                    window.addMedicalSiteFilter(event);
                    console.log('‚úÖ addMedicalSiteFilter executado sem erro');
                } catch (error) {
                    console.log('‚ùå Erro ao executar addMedicalSiteFilter:', error);
                }
            }
        }
        
        // Testar busca externa ap√≥s 5 segundos
        setTimeout(testarBuscaExterna, 5000);
    </script>
</body>
</html>